<!DOCTYPE html>
<title>Furnitur App</title>

<!-- Bootstrap -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
	crossorigin="anonymous"
/>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
	crossorigin="anonymous"
></script>

<!-- Fonts -->
<style>
	@import url("https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
</style>

<div class="container-sm fs-6" style="font-family: 'Poppins', sans-serif">
	<h2 class="fs-4 fw-bold mt-5 mb-3">Berapa Ukuran Kosmu?</h2>
	<form method="post" action="{{ url_for('input_furniture') }}">
		<div class="mt-3 mb-1 row">
			<label class="col-sm-2 col-form-label">Panjang</label>
			<div class="col-sm-10">
				<input
					class="form-control"
					name="kost_length"
					type="number"
					min="1"
					value="{{ kost_length }}"
				/><br />
			</div>
		</div>
		<div class="mb-3 row">
			<label class="col-sm-2 col-form-label">Lebar</label>
			<div class="col-sm-10">
				<input
					class="form-control"
					name="kost_width"
					type="number"
					min="1"
					value="{{ kost_width }}"
				/><br />
			</div>
		</div>
		<span class="w-100 d-flex justify-content-end mb-2"
			><button class="btn btn-primary px-3" type="submit">
				Ubah Ukuran Kos
			</button></span
		>
	</form>
	<hr />

	<div class="d-flex gap-5 mt-5">
		<div class="w-100">
			<h2 class="fs-4 fw-bold mb-3">Tambah Furnitur</h2>
			<form method="post" action="{{ url_for('input_furniture') }}">
				Nama
				<input
					placeholder="Misal : Lemari, Meja"
					autocomplete="off"
					class="mt-2 form-control"
					name="name"
					value=""
				/>
				<br />
				Panjang
				<input
					placeholder="Masukkan panjang dalam meter"
					autocomplete="off"
					class="mt-2 form-control"
					name="length"
					type="number"
					min="1"
				/>
				<br />
				Lebar
				<input
					placeholder="Masukkan lebar dalam meter"
					autocomplete="off"
					class="mt-2 form-control"
					name="width"
					type="number"
					min="1"
				/>
				<br />
				<span class="w-100 d-flex justify-content-end"
					><button class="btn btn-primary px-3" type="submit">
						Tambah
					</button></span
				>
			</form>
		</div>

		<div class="w-100">
			<h3 class="fs-4 fw-bold mb-3">Daftar Furnitur</h3>
			{% if furnitures|length == 0 %}
			<div class="text-secondary">Belum ada furnitur yang ditambahkan.</div>
			{% else %}
			<ol class="list-group list-group-flush d-flex flex-column gap-2">
				{% for furn in furnitures %}
				<li
					class="list-group-item d-flex w-100 align-items-center justify-content-between"
				>
					{{ furn['name'] }} ({{ furn['length'] }}m x {{ furn['width'] }}m)
					<form
						method="post"
						action="{{ url_for('delete_furniture', index=loop.index0) }}"
						style="display: inline"
					>
						<button class="btn btn-outline-danger btn-sm" type="submit">
							Hapus
						</button>
					</form>
				</li>
				{% endfor %}
			</ol>
			{% endif %}
		</div>
	</div>

	<form
		method="post"
		action="{{ url_for('input_furniture') }}"
		style="margin-top: 10px"
	>
		<button
			class="btn btn-success w-100 mt-5"
			type="submit"
			name="generate"
			value="1"
		>
			Generate Tata Letak
		</button>
	</form>
	<hr />

	<h2 class="fs-4 fw-bold">Tata Letak Furnitur Kos</h2>
	<div style="font-size: 13px; color: #555; margin-bottom: 6px">
		<b>Grid scale:</b> 1 sel = {{ grid_scale }} cm &nbsp;|&nbsp; Grid size: {{
		rows }} x {{ cols }}
	</div>
	<table border="1" style="border-collapse: collapse">
		{% set color_map = {} %} {% set color_palette =
		['#b3e5fc','#ffe082','#c8e6c9','#f8bbd0','#fff9c4','#d1c4e9','#ffecb3','#b2dfdb','#f0f4c3','#f5f5f5','#e1bee7','#fce4ec','#e0f7fa','#f9fbe7','#f3e5f5','#e8f5e9','#fffde7','#fbe9e7','#e0f2f1','#f1f8e9']
		%} {% set furn_map = {} %} {% for furn in furnitures %} {% set _ =
		color_map.update({furn['id']: color_palette[(loop.index0) %
		(color_palette|length)]}) %} {% set _ = furn_map.update({furn['id']: furn})
		%} {% endfor %} {% set center_map = {} %} {% for furn in furnitures %} {%
		set id_val = furn['id'] %} {% set cells = [] %} {% for y in range(rows) %}
		{% for x in range(cols) %} {% if grid[y][x] == id_val %} {% set _ =
		cells.append((y, x)) %} {% endif %} {% endfor %} {% endfor %} {% if cells %}
		{% set cy = (cells|map(attribute=0)|sum) // (cells|length) %} {% set cx =
		(cells|map(attribute=1)|sum) // (cells|length) %} {% set _ =
		center_map.update({(cy, cx): id_val}) %} {% endif %} {% endfor %} {% for y
		in range(rows) %}
		<tr>
			{% for x in range(cols) %} {% set cell = grid[y][x] %} {% if cell and
			(cell in color_map) and (cell in furn_map) %}
			<td
				width="50"
				height="50"
				align="center"
				style="background:{{ color_map[cell] }}; font-size:12px; font-weight:bold; color:#333; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; max-width:50px;"
			>
				<div
					style="
						width: 50px;
						overflow: hidden;
						white-space: nowrap;
						text-overflow: ellipsis;
					"
				>
					{% if (y, x) in center_map and center_map[(y, x)] == cell %} {{
					furn_map[cell]['name'] }} {% endif %}
				</div>
			</td>
			{% else %}
			<td width="50" height="50" align="center" style="background: white"></td>
			{% endif %} {% endfor %}
		</tr>
		{% endfor %}
	</table>
	<br />
	<form method="post" action="{{ url_for('reset') }}">
		<button class="btn btn-outline-secondary mb-5" type="submit">
			Reset Grid
		</button>
	</form>
</div>
